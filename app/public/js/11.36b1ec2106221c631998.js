webpackJsonp([11],{"+InV":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r("Xxa5"),s=r.n(a),i=r("exGp"),l=r.n(i),o={components:{GetUserData:r("s8YE").a},data:function(){return{selectUserShow:!1,form:{theme:"",textarea:"",file:"",uploadFileUrl:"",uploadHeaders:"",files:null,user_id:0,filelist:[]},userid:0,admin:!1,uploadData:{urlJurisdiction:window.location.hash.replace("#","")},formPlaceholder:{theme:"输入要创建的主题名字"},isIndeterminate:!0,checkAll:!1,checkedCities:[],rules:{theme:[{required:!0,message:"请输入主题名称"}],textarea:[{required:!0,message:"请输入主题描述"}],file:[{required:!0,message:"请选择图片"}]},userInfo:null,user:null,routeQuery:null}},beforeRouteUpdate:function(e,t,r){r(),location.reload()},created:function(){this.form.uploadFileUrl=this.api.uploadUrl,this.form.uploadHeaders={"x-csrf-token":this.getCatch(this,"csrfToken")},this.userInfo=this.$store.state.userInfo,console.log(this.userInfo,"this.userInfo"),this.form.adminlevel=this.userInfo?this.userInfo.level:0,this.userInfo&&1===this.userInfo.level&&(this.admin=!0),this.routeQuery=this.$route.query,this.$store.state.themeEditDataCache&&(this.form.theme=this.$store.state.themeEditDataCache.theme_name,this.form.textarea=this.$store.state.themeEditDataCache.theme_info,this.form.file=this.$store.state.themeEditDataCache.theme_min_img,this.form.filelist.push({name:this.$store.state.themeEditDataCache.theme_min_img}))},methods:{getSetUser:function(e){this.user=[e],this.userid=e.id},handleCheckedCitiesChange:function(e){},saveThemeData:function(e){var t=this;return l()(s.a.mark(function r(){var a;return s.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:(a=t).form.imgsrc=e,a.form.userid=t.userid,a.form.level=t.user?t.user[0].level:0,a.routeQuery&&a.routeQuery.theme_id&&(a.form.userid=a.routeQuery.userid,a.form.theme_id=a.routeQuery.theme_id),a.$axios({type:"$axios",obj:{url:a.api.addtheme,method:"post",success:function(e){200==e.data.code?(a.$router.push({name:"themeList"}),a.alertsu(e.data.msg)):a.alerter(e.data.msg)},error:function(){a.alertsu("主题保存失败！")},data:a.form,header:{"x-csrf-token":a.getCatch(a,"csrfToken"),"content-type":"application/json; charset=utf-8"}}});case 6:case"end":return r.stop()}},r,t)}))()},saveThemeImg:function(){var e=this;return l()(s.a.mark(function t(){var r,a,i,l;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=e,(a=new FormData).append("file",r.form.files),a.append("urlJurisdiction",window.location.hash.replace("#","")),i=e.user?e.user[0].level:0,r.routeQuery&&r.routeQuery.theme_id?(r.userid=r.routeQuery.userid,l=r.api.uploadUrl+"?urlJurisdiction="+window.location.hash.replace("#","").split("?")[0]+"&userid="+e.userid+"&level="+i+"&adminlevel="+e.form.adminlevel+"&theme_id="+r.routeQuery.theme_id):l=r.api.uploadUrl+"?urlJurisdiction="+window.location.hash.replace("#","").split("?")[0]+"&userid="+e.userid+"&level="+i+"&adminlevel="+e.form.adminlevel,r.$post({url:l,data:{formData_:a,headers:{"x-csrf-token":r.getCatch(r,"csrfToken"),"content-type":"application/json; charset=utf-8"}},config:{},success:function(e){e,200==e.data.code?(r.saveThemeData(e.data.src),r.alertsu(e.data.msg)):r.alerter(e.data.msg)},errror:function(){}});case 7:case"end":return t.stop()}},t,e)}))()},submitTheme:function(){var e=this;e.$refs.ruleForm.validate(function(t){if(!t)return!1;e.saveThemeImg()})},imgImgUpload:function(e,t){if(this.form.file=e.name,this.form.files=e.raw,"image/png"!==e.raw.type&&"image/jpeg"!==e.raw.type&&"image/gif"!==e.raw.type)return this.form.file="",this.$refs.upload.abort(),this.$refs.upload.clearFiles(),this.alerter("请选择png/jpg/gif格式图片上传！"),!1;e.name&&e.size/1024/1024>.1&&(this.form.file="",this.$refs.upload.abort(),this.$refs.upload.clearFiles(),this.alerter("上传文件不能大于100K！"))},selectUser:function(){this.selectUserShow=!0}}},u={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("br"),e._v(" "),r("el-form",{ref:"ruleForm",attrs:{"label-position":this.$store.state.panelLayout,rules:e.rules,model:e.form,"label-width":"150px"}},[e.admin?r("el-row",{attrs:{gutter:24}},[r("el-col",{attrs:{lg:8}},[r("el-form-item",{attrs:{label:"选择用户：",prop:"userid"}},[r("get-user-data",{attrs:{getUserIdFn:e.getSetUser}})],1)],1)],1):e._e(),e._v(" "),r("el-row",{attrs:{gutter:24}},[r("el-col",{attrs:{lg:8}},[r("el-form-item",{attrs:{label:"输入主题名称：",prop:"theme"}},[r("el-input",{attrs:{placeholder:e.formPlaceholder.theme},model:{value:e.form.theme,callback:function(t){e.$set(e.form,"theme",t)},expression:"form.theme"}})],1)],1)],1),e._v(" "),r("el-row",{attrs:{gutter:24}},[r("el-col",{attrs:{lg:8}},[r("el-form-item",{attrs:{label:"主题描述：",prop:"textarea"}},[r("el-input",{attrs:{type:"textarea",rows:3,placeholder:"请输入内容"},model:{value:e.form.textarea,callback:function(t){e.$set(e.form,"textarea",t)},expression:"form.textarea"}})],1)],1)],1),e._v(" "),r("el-row",{attrs:{gutter:24}},[r("el-col",{attrs:{lg:16}},[r("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"缩略图上传：",prop:"file"}},[r("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{drag:"",data:e.uploadData,"auto-upload":!1,action:e.form.uploadFileUrl,headers:e.form.uploadHeaders,"file-list":e.form.filelist,multiple:"","on-change":e.imgImgUpload,"with-credentials":!0}},[r("i",{staticClass:"el-icon-upload"}),e._v(" "),r("div",{staticClass:"el-upload__text"},[e._v("将文件拖到此处，或"),r("em",[e._v("点击上传")])]),e._v(" "),r("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传jpg/png/gif文件，且不超过100kb")])]),e._v(" "),r("el-input",{staticStyle:{display:"none"},attrs:{type:"hidden"},model:{value:e.form.file,callback:function(t){e.$set(e.form,"file",t)},expression:"form.file"}})],1)],1)],1),e._v(" "),r("el-row",{attrs:{gutter:24}},[r("el-col",{attrs:{lg:8}},[r("el-form-item",{attrs:{label:""}},[r("br"),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:e.submitTheme}},[e._v("提交保存")])],1)],1)],1)],1)],1)},staticRenderFns:[]},n=r("VU/8")(o,u,!1,null,null,null);t.default=n.exports}});
//# sourceMappingURL=11.36b1ec2106221c631998.js.map